<!-- *ngIf="this.channelDataService.channelUsers" in class'maincontainer' einfügen zum ausblenden am anfang -->
<div class="main-container">

    <div class="header-container">
        <header class="channel-chat-header">
            <div class="header-left" (click)="editChannelOpen = true; openPopup(); checkUserIsCreator();">
                <span>
                    <span class="hashtag">#</span> {{ this.channelDataService.channelName }}
                    <img src="../../../assets/img/keyboard_arrow_down.png" alt="">
                </span>
            </div>
            <div class="header-right" *ngIf="officialChannel">
                <div class="all-avatar-channel-members" (click)="showMembersOpen = true; openPopup()">
                    <div *ngFor="let user of this.channelDataService.channelUsers ">
                        <span class="profile">
                            <img [src]="getProfileImagePath(user)" />
                            <p class="active-point" *ngIf="user.isOnline == true"></p>
                        </span>
                    </div>
                    <div class="counter-channel-members">{{ this.channelDataService.channelUsers.length }}</div>
                </div>

                <div class="person-add-icon-container">
                    <img src="../../../assets/img/person_add.png" alt="" (click)="addUSerOpen = true; openPopup()">
                </div>
            </div>
        </header>
    </div>


    <!-- '################# Anfang Klemens code -->
    <!--  <div class="answersContainer">
        <div class="threadContainerAnswer" *ngFor="let answer of allMessages"
            [ngClass]="{'threadContainerAnswerReverse' : answer.activeUserMessage}">
            <img class="profilPic" src="./assets/img/{{answer.messageUserProfileImg}}" alt="">
            <div class="threadContainerAnswerContainer" [ngClass]="{'flex-end' : answer.activeUserMessage}">

                <div class="reactionContainer" [ngClass]="{'absoluteLeft' : answer.activeUserMessage}">
                    <div class="reactionMenu">
                        <div class="emoji-container">
                            <img (click)="toggleEmoji(answer.messageID, 1)" src="../../../assets/img/add_reaction.png" alt="">
                            <div *ngIf="answer.isEmojiOpen" class="emoji-selection">
                                <emoji-mart class="emoji-mart" 
                                [style]="{ width: '240px', cursor: 'default' }"
                                (emojiSelect)="handleReaction($event, answer)" 
                                color=#535AF1 
                                set="apple"
                                [enableSearch]="false" 
                                [showPreview]="false" 
                                title="Choose your emoji">
                                </emoji-mart>
                            </div>
                        </div>
                        <div class="editMessage" *ngIf="answer.activeUserMessage">
                            <mat-icon>more_vert</mat-icon>
                            <div class="editMessageBtn">
                                <span >Nachricht bearbeiten</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="threadContainerAnswerInfo"
                    [ngClass]="{'threadContainerAnswerReverse' : answer.activeUserMessage}">
                    <div class="threadContainerInfoPerson">{{answer.messageUserName}}</div>
                    <div class="threadContainerInfoTime">{{answer.timestamp}} Uhr</div>
                </div>
                <div class="threadContainerTextLeft" [ngClass]="{'answerFromRight' : answer.activeUserMessage}">
                    {{answer.messagetext}}
                </div> -->
    <!-- <div class="answer-container">
                    <div *ngIf="answer['answers'].length" > 0' class="counter-answers fs-18 fw-400">{{ answer['answers'].length }} Antworten</div>
                    <div class="last-answer-time fs-14 fw-400">{{ answer.timestamp }}</div>     
                    <div class="reactions" *ngIf="answer['answers'].length == 0">                        
                    </div>
                </div> -->

    <!--  </div>
        </div>
    </div> -->

    <!-- '################# Ende Klemens code -->



    <div class="channel-chat-container">
        <div *ngFor="let message of allMessages; let chatIndex = index">
            <div class="seperator"></div>
            <div class="date-incoming-message">
                <span class="fs-18">{{ message.date | date: 'EEEE, dd MMMM' : 'de' }}</span>
            </div>

            <div [ngClass]="isCurrentUser(chatIndex) ? 'new-message-avatar-container' : 'new-message-somebody-container'"
                style="cursor: default;"
                (mouseenter)="isCurrentUser(chatIndex) ? toggleAnimationState1('visible') : toggleAnimationState('visible', chatIndex)"
                (mouseleave)="isCurrentUser(chatIndex) ? toggleAnimationState1('hidden') : toggleAnimationState('hidden', chatIndex)"
                (mouseleave)="message.isEmojiOpen = false">
                <div>
                    <img class="profile-img"
                        [src]="message.messageUserProfileImg.startsWith('https') ? message.messageUserProfileImg : './assets/img/' + message.messageUserProfileImg"
                        alt="">
                </div>
                <div>
                    <div
                        [ngClass]="isCurrentUser(chatIndex) ? 'name-and-time-container float-right' : 'name-and-time-container float-left'">
                        <div [ngClass]="isCurrentUser(chatIndex) ? 'reaction-menu-message left-87 flex-reverse' : 'reaction-menu-message right-0'"
                            [@slideAndFade]="isCurrentUser(chatIndex) ? animationState1 : message.animationState">

<<<<<<< HEAD
                            <div *ngIf="message.react && message.react.length > 0">
                                <div class="last-emoji">{{getEmojiPath(message, 0)}}</div>
=======
                                <div *ngIf="message.react.selectedEmojis && message.react.selectedEmojis.length > 0">
                                    <div class="last-emoji">{{getEmojiPath(message, 0)}}</div>
                                </div>
                                <div *ngIf="message.react.selectedEmojis && message.react.selectedEmojis.length > 1">
                                    <div class="last-emoji">{{getEmojiPath(message, 1)}}</div>
                                </div>

                                
                                <div class="emoji-container">
                                    <img (click)="toggleEmoji($event, chatIndex)" src="./assets/img/add_reaction.png" alt="" class="react-icon">
                                    <div *ngIf="message.isEmojiOpen" [ngClass]="isCurrentUser(chatIndex) ? 'emoji-selection left-1' : 'emoji-selection right-43'">
                                        <app-emoji-picker (emojiSelect)="emojiSelected($event, chatIndex); closeEmojiContainers(chatIndex)"></app-emoji-picker>
                                    </div>
                                </div>    
                                <div>
                                    <img class="react-icon" src="./assets/img/Answer.png" alt="" (click)="openThread(message.messageID)">
                                </div>
                                <div *ngIf="isCurrentUser(chatIndex)">
                                    <img (click)="editMessage(this.channelDataService.channelID)" class="edit-icon" src="./assets/img/edit-message.png" alt="">
                                </div>

>>>>>>> e27dcc37a545c32a3b7edaea86dc92a56c9dc70c
                            </div>
                            <div *ngIf="message.react && message.react.length > 1">
                                <div class="last-emoji">{{getEmojiPath(message, 1)}}</div>
                            </div>


                            <div class="emoji-container">
                                <img (click)="toggleEmoji($event, chatIndex)" src="./assets/img/add_reaction.png" alt=""
                                    class="react-icon">
                                <div *ngIf="message.isEmojiOpen"
                                    [ngClass]="isCurrentUser(chatIndex) ? 'emoji-selection left-1' : 'emoji-selection right-43'">
                                    <app-emoji-picker
                                        (emojiSelect)="handleReactionMessage($event, message); closeEmojiContainers(chatIndex)"></app-emoji-picker>
                                </div>
                            </div>
                            <div>
                                <img class="react-icon" src="./assets/img/Answer.png" alt=""
                                    (click)="openThread(message.messageID)">
                            </div>
                            <div *ngIf="isCurrentUser(chatIndex)">
                                <img (click)="editMessage(channelID)" class="edit-icon"
                                    src="./assets/img/edit-message.png" alt="">
                            </div>

                        </div>
                        <div class="writing-name-sending-time">
                            <ng-container *ngIf="isCurrentUser(chatIndex); else otherUser">
                                <div class="sending-time fs-14 f400">{{ message.timestamp }} Uhr</div>
                                <span class="writing-name fs-18 fw-700">{{ message.messageUserName }}</span>
                            </ng-container>
                            <ng-template #otherUser>
                                <div class="writing-name fs-18 fw-700">{{ message.messageUserName }}</div>
                                <span class="sending-time fs-14 fw-400">{{ message.timestamp }} Uhr</span>
                            </ng-template>
                        </div>
                    </div>
                    <div
                        [ngClass]="isCurrentUser(chatIndex) ? 'message-avatar fs-18 fw-400' : 'message-somebody fs-18 fw-400'">
                        {{ message.messagetext }}</div>

                    <div class="answer-container" *ngIf="message.answerInfo.counter > 0"
                        (click)="openThread(message.messageID)">
                        <!-- <div>{{answer.answertext}}</div> -->
                        <div class="counter-answers fs-18 fw-400">{{ message.answerInfo.counter }} Antworten</div>
                        <div class="last-answer-time fs-14 fw-400">Letzte Antwort {{ message.answerInfo.lastAnswerTime
                            }}</div>
                        <!-- <div class="reactions" *ngIf="message.answerInfo.counter == 0">
                                <img (click)="toggleEmoji($event, chatIndex)" src="./assets/img/add_reaction.png" alt="">
                                <ng-container *ngIf="message.react.selectedEmojis && message.react.selectedEmojis.length > 0">
                                    <div class="single-emoji" *ngFor="let selectedEmoji of getUniqueEmojis(message.react.selectedEmojis)">
                                        {{ selectedEmoji }}{{ getEmojiCount(message.react.selectedEmojis, selectedEmoji) > 1 ? ' ' + getEmojiCount(message.react.selectedEmojis, selectedEmoji) : '' }}
                                    </div>
                                </ng-container>
                            </div> -->
                    </div>
                    <div class="threadContainerTextReactions">
                        <div class="threadContainerTextReactionsEmojis" *ngFor="let reaction of message.react">
                            <div class="reactionsInfoContainer">
                                <div>{{reaction.emoji}}</div>
                                <div class="reactionsInfoContainerUsers"
                                    *ngFor="let user of reaction.user; let i = index">
                                    <div class="user">{{user}}</div>
                                    <div *ngIf="i < (reaction.user.length - 1)"> &</div>
                                </div>
                                <span>hat reagiert</span>
                            </div>
                            <div>{{reaction.emoji}}</div>
                            <div class="threadContainerTextReactionsAmount">{{reaction.user.length}}</div>
                        </div>
                        <div class="emoji-con">
                            <img (click)="toggleEmoji($event, chatIndex)" src="../../../assets/img/add_reaction.png"
                                alt="">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>




    <div class="footer-write-new-message">
        <div>
            <textarea class="textarea" placeholder="Nachricht an # {{ this.channelDataService.channelName }}"
                [(ngModel)]="messagetext"></Textarea>
        </div>
        <div class="footer-line-icons">
            <div class="footer-icons-left">
                <mat-icon>add</mat-icon>
                <div class="seperator-vert"></div>
                <mat-icon>mood</mat-icon>
                <mat-icon>alternate_email</mat-icon>
            </div>
            <div class="footer-icons-right">
                <mat-icon (click)="addMessage()">send_icon</mat-icon>
            </div>
        </div>
    </div>
</div>

<!---------------------------------------------- POPUPS ---------------------------------------------->


<div class="popup-background" *ngIf="addUSerOpen" (click)="addUSerOpen = false; closePopup()">
    <div class="popup-maincontainer smallPopup addUserPopup" (click)="doNotClose($event)">
        <div class="headline-container">
            <span class="fw-700">Leute hinzufügen</span>
            <div class="close-icon-container" (click)="addUSerOpen = false; closePopup()">
                <mat-icon>close</mat-icon>
            </div>
        </div>
        <div class="fw-400 fs-18 channel-container">
            <div>#</div><span> {{ this.channelDataService.channelName }}</span>
        </div>
        <div>
            <!-- User filter function -->
            <div class="user-selection-container mrgn-bt-25">
                <div class="selected-users-container">
                    <div class="selected-users" *ngFor="let user of selectedUsers">
                        <span class="profile">
                            <img [src]="getProfileImagePath(user)" />
                        </span>
                        {{ user.firstname + " " + user.lastname }}
                        <span (click)="removeUser(user)"><mat-icon>close</mat-icon></span>
                    </div>
                    <div class="relative">
                        <input placeholder="Name eingeben" type="text"
                            class="channel-create-input channel-create-description-input"
                            (input)="onSearchInputChange($event)" [(ngModel)]="searchQuery" />
                        <div class="contacts-list-pop-up" *ngIf="searchQuery.trim()" [@rollOutInAnimation]>
                            <div class="contacts-list">
                                <div *ngFor="let user of filterUsers()" (click)="selectUser(user)">
                                    <span class="profile">
                                        <img [src]="getProfileImagePath(user)" />
                                        <p class="active-point" *ngIf="user.isOnline == true"></p>
                                    </span>
                                    <span>{{ user.firstname }} {{ user.lastname }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="btn-container">
            <button class="btn fw-700 fs-18" [class.enabled]="enabled"
                (click)="addNewMemberToChannelUsers(); addUSerOpen = false; closePopup()">Hinzufügen</button>
        </div>
    </div>
</div>


<div class="popup-background" *ngIf="showMembersOpen" (click)="showMembersOpen = false; closePopup()">
    <div class="popup-maincontainer smallPopup showMembersPopup" (click)="doNotClose($event)">
        <div class="headline-container">
            <span class="fw-700">Mitglieder</span>
            <div class="close-icon-container" (click)="showMembersOpen = false; closePopup()">
                <mat-icon>close</mat-icon>
            </div>
        </div>

        <div class="current-channel-member-list">
            <div class="member-list-div" (click)="setUserProfileView(user); showProfil = true; openPopup()"
                *ngFor="let user of this.channelDataService.channelUsers">
                <span class="profile">
                    <img [src]="getProfileImagePath(user)" />
                    <p class="active-point" *ngIf="user.isOnline == true"></p>
                </span>
                <span>{{ user.firstname }} {{ user.lastname }}</span>
            </div>
            <div class="add-person-container fs-18" (click)="addUSerOpen = true; showMembersOpen = false; openPopup()">
                <div class="add-person-img-container">
                    <img src="../../../assets/img/person_add.png" alt="">
                </div>
                <span>Mitglieder hinzufügen</span>
            </div>
        </div>
    </div>
</div>


<div class="popup-background profile-background" *ngIf="showProfil" (click)="showProfil = false; closePopup()">
    <div class="profile-popup" (click)="doNotClose($event)">
        <div class="headline-container">
            <span class="fw-700">Profil</span>
            <div class="close-icon-container" (click)="showProfil = false;">
                <mat-icon>close</mat-icon>
            </div>
        </div>

        <div class="profil-detail-view">
            <div class="profile-img-big-container">
                <img [src]="getProfileImagePath(userProfileView)" />
            </div>
            <div class="profile-info-container">
                <span class="profile-name">{{ userProfileView.firstname }} {{ userProfileView.lastname }}</span>
                <div class="activ-sign" *ngIf="userProfileView.isOnline">
                    <img src="../../../assets/img/online.png" alt="">
                    <span class="activ-txt" *ngIf="userProfileView.isOnline">Aktiv</span>
                </div>
                <div class="profile-mail-container">
                    <div class="mail-description">
                        <img src="../../../assets/img/mail.png" alt="">
                        <span>E-Mail-Adresse</span>
                    </div>
                    <div class="mail-container">
                        {{ userProfileView.email }}
                    </div>
                </div>
            </div>
            <div class="message-btn-container" (click)="openChannelDirectMessage()">
                <button class="btn enabled send-message-btn">
                    <img src="../../../assets/img/mode_comment.png" alt="">
                    <span>Nachricht</span>
                </button>
            </div>

        </div>
    </div>
</div>


<div class="popup-background" *ngIf="editChannelOpen" (click)="editChannelOpen = false; closePopup()">
    <div class="popup-maincontainer bigPopup editChannelPopup" (click)="doNotClose($event)">
        <div class="headline-container">
            <span class="fw-700"><span>#</span><span> {{ this.channelDataService.channelName }}</span></span>
            <div class="close-icon-container" (click)="editChannelOpen = false; closePopup()">
                <mat-icon>close</mat-icon>
            </div>
        </div>


        <div class="edit-maincontainer">
            <div class="edit-channel-name-container" [@removeBorder]="channelNameChange">
                <div class="subline-edit-channel">
                    <span class="fw-700">Channel-Name</span>
                    <span class="edit-btn" *ngIf="!channelNameChange"
                        (click)="channelNameChange = true">Bearbeiten</span>
                    <span class="edit-btn" *ngIf="channelNameChange"
                        (click)="channelNameChange = false; saveNewChannelName()">Speichern</span>
                </div>
                <div class="channel-name-container" *ngIf="!channelNameChange">
                    <div class="fw-700">#</div> <span class="channel-name"> {{ this.channelDataService.channelName
                        }}</span>
                </div>
                <div>
                    <input type="text" [(ngModel)]="newChannelName" autofocus
                        placeholder="{{  this.channelDataService.channelName }}" *ngIf="channelNameChange"
                        class="input-change-channel-name">
                </div>
            </div>


            <div class="edit-channel-description-container" [@removeBorder]="channelDescriptionChange">
                <div class="subline-edit-channel">
                    <span class="fw-700">Beschreibung</span>
                    <span class="edit-btn" *ngIf="!channelDescriptionChange"
                        (click)="channelDescriptionChange = true">Bearbeiten</span>
                    <span class="edit-btn" *ngIf="channelDescriptionChange"
                        (click)="channelDescriptionChange = false; saveNewDescription()">Speichern</span>
                </div>
                <div class="channel-description">
                    <span class="channel-description-text" *ngIf="!channelDescriptionChange">{{
                        this.channelDataService.channelDescription }}</span>
                    <input type="text" [(ngModel)]="newChannelDescription" autofocus *ngIf="channelDescriptionChange"
                        placeholder="Dein Text hier">
                    <div class="seperator"></div>
                    <span class="fw-700">Erstellt von</span>
                    <div class="channel-creator-container">
                        <div class="edited-by-name">{{ this.channelDataService.channelCreator }}</div>
                        <button *ngIf="isChannelCreator" class="btn enabled" (click)="editChannelOpen = false; 
                        deleteCurrentChannel(); 
                        closePopup()">Channel löschen</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="btn-container">
            <button class="btn enabled" (click)="leaveChannel(); editChannelOpen = false; closePopup()">Channel
                verlassen</button>
        </div>

    </div>
</div>